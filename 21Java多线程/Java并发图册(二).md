# JAVA并发图册(二)

[toc]

## 7. 面试官问创建多少个线程合适？

试着回答一下下面脑图里面的问题

![image-20210707195434816](https://tva1.sinaimg.cn/large/008i3skNly1gs8ms28qh2j310c0jsgw7.jpg)

### 为什么要用多线程？用多少个合适呢？

使用多线程就是在**正确的场景**下通过设置**正确个数的线程** 来最大化程序的运行速度。

这就是充分利用 CPU 和 I/O的利用率，充分榨取。  这就是从 【定性】和【定量】两个角度分析

#### 【定性】正确的场景

- CPU密集型 ： 单核不适合多线程， 如果是「多核」CPU，完全可以最大化利用CPU核心数
- IO密集型：线程等待比率越高， 需要越多

**总结：线程等待时间所占比例越高，需要越多线程；线程CPU时间所占比例越高，需要越少线程**

#### 【定量】多少个呢

- CPU密集型：   CPU核数 + 1 ，   1是backup
- I/O密集型： 【单核】最佳线程数 = (1/CPU利用率) = 1 + （IO耗时 / CPU耗时） 
                       【多核】最佳线程数 = CPU核心数 * (1/CPU利用率) = CPU核心数 * (1+(IO耗时 / CPU耗时))

初始按这样就行，不过后面还要调优

上面有两个疑问点：

1. 怎么知道具体 IO 耗时 和 CPU耗时呢？ 
2. 怎么查看CPU利用率？ 

 APM工具 ： 1. Skywalking 2. CAT 3. zipkin

